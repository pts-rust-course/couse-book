


# План курса


## Вводное

### Зачем нужен **Rust**?

Рассказываем о других языках и проблемах, которые **Rust** призван
решить.

### Основные идеи **Rust**

Рассказываем о `Borrow Rules`, `Lifetimes`, и о том, как они решают
проблемы работы с памятью. Показываем примеры кода, рассказываем о еще
нескольких важных понятиях для **Rust**.

### Tooling

Рассказываем про экосистему, средства сборки, показываем и наглядно
используем `cargo`. Говорим про установку и поддержку в IDE. Пара слов
про `nightly`, `toolchain`-ы и `no-std`.

## Основы синтаксиса

### Простейший синтаксис

`let; if; while; for + range; loop; fn`. Простейшие декларативные
макросы. Рассказываем про общую идею выражений **Rust**, обращаем
внимание на мутабельность.

### Примитивы

`bool; u64; i64; f64`. `usize`. Составные типы. Tuples, `[x;n]`. `Vec`
как пример сложного `Non-Copy` объекта.

### Простейшие ссылки

Синтаксис, разыменовывание, Borrow rule. Пример "нетривиальных" ссылок
на основе `slice`-в `Vec`-ов.

## Структуры и алгебраические типы данных

### Что это такое

`struct; enum`. Пара слов о внутреннем представлении. Работа с `impl`,
`self, &self, &mut self`.

### Match

`match` ветки, паттерны, применение для `enum`. Продвинутые паттерны.

### Пример применения: обработка ошибок

Проблемы `panic!`. `Option, Result`, `?`. Примеры методов из стандартной
библиотеки: комбинаторы.

## Введение в `trait`-ы и generic-и

### Что это такое и зачем нужно

Написание кода, который опирается не на конкретные типы, а их свойства.
Синтаксис `trait`-ов и ограничений на `generic`-ки. Сравнение с
интерфейсами из ООП языков и шаблонами/`generic`-ами в С++/Java
соответственно.

### Примеры основных `trait`-ов, определенных в стандратной библиотеке

`Clone; Default; Eq; Ord; Display; Drop` и другие. Примеры `trait`-ов,
имеющих особую интеграцию с компилятором. Oprhan rules. Использование
`derive` макросов для избегания ручной работы.

### Во что компилируется

Мономорфизация. Влияние на compile time, runtime (оптимизазции, кэш) и
потребляемую память.

## Динамический полиморфизм

### Умные указатели

`Box; Rc`: задачи каждого, идея реализация в стандартной бибилотеке.

Представление DST в памяти --- «жирные» указатели: `[T]`, `dyn Trait`.

### `trait objects`: задачи, реализация

Границы применимости static и dynamic dispatch. Object safety.

Сравнение с другими подходами и языками: библиотека `enum_dispatch`,
реализация полиморфизма в Haskell, Java и C++.

### Пример применения для обработки ошибок: dyn Error

Преимущества и недостатки по сравнению с отсутствием type erasure.

Библиотеки макросов для создания своих типов ошибок и оборачивания
функций.

## Функции и Итераторы

### Замыкания

Синтаксис замыканий и `Fn`-трейты. Внутренние устройство замыканий.

### Использование замыканий: комбинаторы итераторов

`trait Iterator` и его расширения. Ускорение кода. Примеры использования
комбинаторов: `filter`, `map`, `flatten` и другие. Связанные с
итераторами `trait`-ы: `IntoIterator` и `FromIterator`.

### Реализация итератора

Пример реализации итератора для кастомной структуры.

## Модули

### Основы

`mod`, области видимости. Пути, `super`, `crate`, `::`, обращения к
стандартной библиотеке.

### Сборка, конфигурация и инструменты

`rustc`. Файл `toml`. Оптимизации. `no-std`. Сборка под библиотеки и
бинарники. `##[cfg]`. `build.rs`. `cargo fmt` и `clippy`. `##[allow]` и
другие.

### Библиотеки

Установка через запись в `toml`. Features. Установка из
Github-репозиториев. Примеры: itertools, serde, lazy-static

## Lifetimes

### Обоснование необходимости

Примеры ошибок, возможных в C++, которые позволяют избежать система
владения и времена жизни в Rust.

### Правила ссылок, реализация в компиляторе

Обобщение примеров выше, формулировка правил, постановка задачи
компилятора. Lifetime elision, ограничения подхода.

### Взаимодействия с другими средствами языка

Конкурентное изменение, избегание data race-ов. Оптимизации, которые
даёт анализ алиасов. Релаксация ограничений с помощью Interior
Mutability.

## Unsafe

### Что разрешает `unsafe`?

Операции, допустимые в `unsafe`. Работа с сырыми указателями. Утечки
памяти. Undefined behaviour.

### `unsafe` для безопасных абстракций

Инкапсуляция `unsafe` кода, разделение ответственности. Инструменты для
детектирования плохих мест в `unsafe`.

### FFI

Безопасные обертки над небезопасными библиотеками. Пример вызовов
`C++`-кода.

## Макросы

### Обзор

Идеология. Возможности. Ограничения. Сравнение с C++.

### Декларативные

Работа с семантическими токенами. Виды токенов. Разбор работы `dbg!`.
Пример декларативного макроса.

### Процедурные

Вычисления в compile-time. Библиотеки для макросов. `cite`, `quote`,
`syn`. `##[derive]`. Пример процедурного макроса.

## Многопоточность

### Потоки

Современный характер выполнения закона Мура (многоядерные процессоры).
Обзор средств стандратной библиотеки для работы с потоками. Примитивы
синхронизации.

### Абстракции над потоками

-   thread pool

-   Подход библиотеки rayon (data parallelism, work-stealing)

### Async

-   Примеры ситуаций, где процессорное время --- не ограничитель
    производительности.

-   Поддержка создания конечных автоматов на уровне языка через ключевые
    слова

-   future-ы, executor-ы

-   Примеры асинхронных фреймворков: tokio, smol (для контроллеров).

-   Поддержка на уровне операционной системы и устройств ввода/вывода,
    прерывания.

## Снова библиотеки

### Обзор популярных проектов

Tauri, Typst, Bevy, Polars, Chumsky. Обсуждение, какие используются фичи
Rust.

### GUI с помощью `egui`

Идеология `immidiate view` GUI. Minimal working example. Экспорт в
WebAssembly.

### Библиотека для Python

Мотивация. `rustimport`. Минимальный пример.

## Embedded stuff

### Работа в условиях `no-std`

-   Отсутствие операционной системы

-   Hard real time --- предсказуемость производительности (избегание
    аллокаций, амортизированной асимптотики)

-   memory-mapped I/O

-   Прерывания, interrupt controller

-   Периферии: концепция, примеры

-   Direct memory access

### Применение механизмов языка

Паттерны для embedded

-   typestate

-   borrow checker

-   singleton

-   модели асинхронности, библиотека `nb`.

### Библиотеки, экосистема

-   Взаимодействие с кодом на C.

-   RTOS

-   Экосистема embedded-hal.

-   Фреймворк embassy-rs.

### Демонстрация работы

Пример устройства из физического мира, контроллер на котором
запрограммирован на Rust.

<style>
	.content {
	    counter-reset: h1;
	}
	.content h1 {
	    counter-reset: h2;
	    counter-set: h2 -1;
	}

	.content h2 {
	    counter-reset: h3
	}

	.content h3 {
	    counter-reset: h4
	}

	.content h2:before {
	    counter-increment: h2;
	    content: "Занятие №" counter(h2) ": "
	}

	.content h3:before {
	    counter-increment: h3;
	    content: counter(h2) "." counter(h3) ". "
	}

	.content h4:before {
	    counter-increment: h4;
	    content: counter(h2) "." counter(h3) "." counter(h4) ". "
	}

</style>